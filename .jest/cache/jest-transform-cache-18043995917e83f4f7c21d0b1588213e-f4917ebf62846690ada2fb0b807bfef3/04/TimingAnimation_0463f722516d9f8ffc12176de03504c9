65139ce61232ce4834c08340d603e5a1
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var AnimatedValue = require('../nodes/AnimatedValue');

var AnimatedValueXY = require('../nodes/AnimatedValueXY');

var Animation = require('./Animation');

var _require = require('../NativeAnimatedHelper'),
    shouldUseNativeDriver = _require.shouldUseNativeDriver;

var _easeInOut;

function easeInOut() {
  if (!_easeInOut) {
    var Easing = require('Easing');

    _easeInOut = Easing.inOut(Easing.ease);
  }

  return _easeInOut;
}

var TimingAnimation = function (_Animation) {
  (0, _inherits2.default)(TimingAnimation, _Animation);

  function TimingAnimation(config) {
    var _this;

    (0, _classCallCheck2.default)(this, TimingAnimation);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(TimingAnimation).call(this));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_startTime", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_fromValue", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_toValue", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_duration", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_delay", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_easing", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_onUpdate", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_animationFrame", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_timeout", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_useNativeDriver", void 0);
    _this._toValue = config.toValue;
    _this._easing = config.easing !== undefined ? config.easing : easeInOut();
    _this._duration = config.duration !== undefined ? config.duration : 500;
    _this._delay = config.delay !== undefined ? config.delay : 0;
    _this.__iterations = config.iterations !== undefined ? config.iterations : 1;
    _this.__isInteraction = config.isInteraction !== undefined ? config.isInteraction : true;
    _this._useNativeDriver = shouldUseNativeDriver(config);
    return _this;
  }

  (0, _createClass2.default)(TimingAnimation, [{
    key: "__getNativeAnimationConfig",
    value: function __getNativeAnimationConfig() {
      var frameDuration = 1000.0 / 60.0;
      var frames = [];

      for (var dt = 0.0; dt < this._duration; dt += frameDuration) {
        frames.push(this._easing(dt / this._duration));
      }

      frames.push(this._easing(1));
      return {
        type: 'frames',
        frames: frames,
        toValue: this._toValue,
        iterations: this.__iterations
      };
    }
  }, {
    key: "start",
    value: function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
      var _this2 = this;

      this.__active = true;
      this._fromValue = fromValue;
      this._onUpdate = onUpdate;
      this.__onEnd = onEnd;

      var start = function start() {
        if (_this2._duration === 0 && !_this2._useNativeDriver) {
          _this2._onUpdate(_this2._toValue);

          _this2.__debouncedOnEnd({
            finished: true
          });
        } else {
          _this2._startTime = Date.now();

          if (_this2._useNativeDriver) {
            _this2.__startNativeAnimation(animatedValue);
          } else {
            _this2._animationFrame = requestAnimationFrame(_this2.onUpdate.bind(_this2));
          }
        }
      };

      if (this._delay) {
        this._timeout = setTimeout(start, this._delay);
      } else {
        start();
      }
    }
  }, {
    key: "onUpdate",
    value: function onUpdate() {
      var now = Date.now();

      if (now >= this._startTime + this._duration) {
        if (this._duration === 0) {
          this._onUpdate(this._toValue);
        } else {
          this._onUpdate(this._fromValue + this._easing(1) * (this._toValue - this._fromValue));
        }

        this.__debouncedOnEnd({
          finished: true
        });

        return;
      }

      this._onUpdate(this._fromValue + this._easing((now - this._startTime) / this._duration) * (this._toValue - this._fromValue));

      if (this.__active) {
        this._animationFrame = requestAnimationFrame(this.onUpdate.bind(this));
      }
    }
  }, {
    key: "stop",
    value: function stop() {
      (0, _get2.default)((0, _getPrototypeOf2.default)(TimingAnimation.prototype), "stop", this).call(this);
      this.__active = false;
      clearTimeout(this._timeout);
      global.cancelAnimationFrame(this._animationFrame);

      this.__debouncedOnEnd({
        finished: false
      });
    }
  }]);
  return TimingAnimation;
}(Animation);

module.exports = TimingAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlRpbWluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZFZhbHVlIiwicmVxdWlyZSIsIkFuaW1hdGVkVmFsdWVYWSIsIkFuaW1hdGlvbiIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIl9lYXNlSW5PdXQiLCJlYXNlSW5PdXQiLCJFYXNpbmciLCJpbk91dCIsImVhc2UiLCJUaW1pbmdBbmltYXRpb24iLCJjb25maWciLCJfdG9WYWx1ZSIsInRvVmFsdWUiLCJfZWFzaW5nIiwiZWFzaW5nIiwidW5kZWZpbmVkIiwiX2R1cmF0aW9uIiwiZHVyYXRpb24iLCJfZGVsYXkiLCJkZWxheSIsIl9faXRlcmF0aW9ucyIsIml0ZXJhdGlvbnMiLCJfX2lzSW50ZXJhY3Rpb24iLCJpc0ludGVyYWN0aW9uIiwiX3VzZU5hdGl2ZURyaXZlciIsImZyYW1lRHVyYXRpb24iLCJmcmFtZXMiLCJkdCIsInB1c2giLCJ0eXBlIiwiZnJvbVZhbHVlIiwib25VcGRhdGUiLCJvbkVuZCIsInByZXZpb3VzQW5pbWF0aW9uIiwiYW5pbWF0ZWRWYWx1ZSIsIl9fYWN0aXZlIiwiX2Zyb21WYWx1ZSIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJzdGFydCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9zdGFydFRpbWUiLCJEYXRlIiwibm93IiwiX19zdGFydE5hdGl2ZUFuaW1hdGlvbiIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJnbG9iYWwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLGFBQWEsR0FBR0MsT0FBTyxDQUFDLHdCQUFELENBQTdCOztBQUNBLElBQU1DLGVBQWUsR0FBR0QsT0FBTyxDQUFDLDBCQUFELENBQS9COztBQUNB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LEtBQUt5QixVQUR4QixDQUZKOztBQUtBLFVBQUksS0FBS0QsUUFBVCxFQUFtQjtBQUNqQixhQUFLVyxlQUFMLEdBQXVCQyxxQkFBcUIsQ0FBQyxLQUFLaEIsUUFBTCxDQUFjaUIsSUFBZCxDQUFtQixJQUFuQixDQUFELENBQTVDO0FBQ0Q7QUFDRjs7OzJCQUVZO0FBQ1g7QUFDQSxXQUFLYixRQUFMLEdBQWdCLEtBQWhCO0FBQ0FnQixNQUFBQSxZQUFZLENBQUMsS0FBS0YsUUFBTixDQUFaO0FBQ0FHLE1BQUFBLE1BQU0sQ0FBQ0Msb0JBQVAsQ0FBNEIsS0FBS1AsZUFBakM7O0FBQ0EsV0FBS04sZ0JBQUwsQ0FBc0I7QUFBQ0MsUUFBQUEsUUFBUSxFQUFFO0FBQVgsT0FBdEI7QUFDRDs7O0VBMUcyQnZDLFM7O0FBNkc5Qm9ELE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjlDLGVBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkVmFsdWUgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlJyk7XG5jb25zdCBBbmltYXRlZFZhbHVlWFkgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlWFknKTtcbmNvbnN0IEFuaW1hdGlvbiA9IHJlcXVpcmUoJy4vQW5pbWF0aW9uJyk7XG5cbmNvbnN0IHtzaG91bGRVc2VOYXRpdmVEcml2ZXJ9ID0gcmVxdWlyZSgnLi4vTmF0aXZlQW5pbWF0ZWRIZWxwZXInKTtcblxuaW1wb3J0IHR5cGUge0FuaW1hdGlvbkNvbmZpZywgRW5kQ2FsbGJhY2t9IGZyb20gJy4vQW5pbWF0aW9uJztcblxuZXhwb3J0IHR5cGUgVGltaW5nQW5pbWF0aW9uQ29uZmlnID0gQW5pbWF0aW9uQ29uZmlnICYge1xuICB0b1ZhbHVlOiBudW1iZXIgfCBBbmltYXRlZFZhbHVlIHwge3g6IG51bWJlciwgeTogbnVtYmVyfSB8IEFuaW1hdGVkVmFsdWVYWSxcbiAgZWFzaW5nPzogKHZhbHVlOiBudW1iZXIpID0+IG51bWJlcixcbiAgZHVyYXRpb24/OiBudW1iZXIsXG4gIGRlbGF5PzogbnVtYmVyLFxufTtcblxuZXhwb3J0IHR5cGUgVGltaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlID0gQW5pbWF0aW9uQ29uZmlnICYge1xuICB0b1ZhbHVlOiBudW1iZXIgfCBBbmltYXRlZFZhbHVlLFxuICBlYXNpbmc/OiAodmFsdWU6IG51bWJlcikgPT4gbnVtYmVyLFxuICBkdXJhdGlvbj86IG51bWJlcixcbiAgZGVsYXk/OiBudW1iZXIsXG59O1xuXG5sZXQgX2Vhc2VJbk91dDtcbmZ1bmN0aW9uIGVhc2VJbk91dCgpIHtcbiAgaWYgKCFfZWFzZUluT3V0KSB7XG4gICAgY29uc3QgRWFzaW5nID0gcmVxdWlyZSgnRWFzaW5nJyk7XG4gICAgX2Vhc2VJbk91dCA9IEVhc2luZy5pbk91dChFYXNpbmcuZWFzZSk7XG4gIH1cbiAgcmV0dXJuIF9lYXNlSW5PdXQ7XG59XG5cbmNsYXNzIFRpbWluZ0FuaW1hdGlvbiBleHRlbmRzIEFuaW1hdGlvbiB7XG4gIF9zdGFydFRpbWU6IG51bWJlcjtcbiAgX2Zyb21WYWx1ZTogbnVtYmVyO1xuICBfdG9WYWx1ZTogYW55O1xuICBfZHVyYXRpb246IG51bWJlcjtcbiAgX2RlbGF5OiBudW1iZXI7XG4gIF9lYXNpbmc6ICh2YWx1ZTogbnVtYmVyKSA9PiBudW1iZXI7XG4gIF9vblVwZGF0ZTogKHZhbHVlOiBudW1iZXIpID0+IHZvaWQ7XG4gIF9hbmltYXRpb25GcmFtZTogYW55O1xuICBfdGltZW91dDogYW55O1xuICBfdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogVGltaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl90b1ZhbHVlID0gY29uZmlnLnRvVmFsdWU7XG4gICAgdGhpcy5fZWFzaW5nID0gY29uZmlnLmVhc2luZyAhPT0gdW5kZWZpbmVkID8gY29uZmlnLmVhc2luZyA6IGVhc2VJbk91dCgpO1xuICAgIHRoaXMuX2R1cmF0aW9uID0gY29uZmlnLmR1cmF0aW9uICE9PSB1bmRlZmluZWQgPyBjb25maWcuZHVyYXRpb24gOiA1MDA7XG4gICAgdGhpcy5fZGVsYXkgPSBjb25maWcuZGVsYXkgIT09IHVuZGVmaW5lZCA/IGNvbmZpZy5kZWxheSA6IDA7XG4gICAgdGhpcy5fX2l0ZXJhdGlvbnMgPSBjb25maWcuaXRlcmF0aW9ucyAhPT0gdW5kZWZpbmVkID8gY29uZmlnLml0ZXJhdGlvbnMgOiAxO1xuICAgIHRoaXMuX19pc0ludGVyYWN0aW9uID1cbiAgICAgIGNvbmZpZy5pc0ludGVyYWN0aW9uICE9PSB1bmRlZmluZWQgPyBjb25maWcuaXNJbnRlcmFjdGlvbiA6IHRydWU7XG4gICAgdGhpcy5fdXNlTmF0aXZlRHJpdmVyID0gc2hvdWxkVXNlTmF0aXZlRHJpdmVyKGNvbmZpZyk7XG4gIH1cblxuICBfX2dldE5hdGl2ZUFuaW1hdGlvbkNvbmZpZygpOiBhbnkge1xuICAgIGNvbnN0IGZyYW1lRHVyYXRpb24gPSAxMDAwLjAgLyA2MC4wO1xuICAgIGNvbnN0IGZyYW1lcyA9IFtdO1xuICAgIGZvciAobGV0IGR0ID0gMC4wOyBkdCA8IHRoaXMuX2R1cmF0aW9uOyBkdCArPSBmcmFtZUR1cmF0aW9uKSB7XG4gICAgICBmcmFtZXMucHVzaCh0aGlzLl9lYXNpbmcoZHQgLyB0aGlzLl9kdXJhdGlvbikpO1xuICAgIH1cbiAgICBmcmFtZXMucHVzaCh0aGlzLl9lYXNpbmcoMSkpO1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnZnJhbWVzJyxcbiAgICAgIGZyYW1lcyxcbiAgICAgIHRvVmFsdWU6IHRoaXMuX3RvVmFsdWUsXG4gICAgICBpdGVyYXRpb25zOiB0aGlzLl9faXRlcmF0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgc3RhcnQoXG4gICAgZnJvbVZhbHVlOiBudW1iZXIsXG4gICAgb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkLFxuICAgIG9uRW5kOiA/RW5kQ2FsbGJhY2ssXG4gICAgcHJldmlvdXNBbmltYXRpb246ID9BbmltYXRpb24sXG4gICAgYW5pbWF0ZWRWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fZnJvbVZhbHVlID0gZnJvbVZhbHVlO1xuICAgIHRoaXMuX29uVXBkYXRlID0gb25VcGRhdGU7XG4gICAgdGhpcy5fX29uRW5kID0gb25FbmQ7XG5cbiAgICBjb25zdCBzdGFydCA9ICgpID0+IHtcbiAgICAgIC8vIEFuaW1hdGlvbnMgdGhhdCBzb21ldGltZXMgaGF2ZSAwIGR1cmF0aW9uIGFuZCBzb21ldGltZXMgZG8gbm90XG4gICAgICAvLyBzdGlsbCBuZWVkIHRvIHVzZSB0aGUgbmF0aXZlIGRyaXZlciB3aGVuIGR1cmF0aW9uIGlzIDAgc28gYXMgdG9cbiAgICAgIC8vIG5vdCBjYXVzZSBpbnRlcm1peGVkIEpTIGFuZCBuYXRpdmUgYW5pbWF0aW9ucy5cbiAgICAgIGlmICh0aGlzLl9kdXJhdGlvbiA9PT0gMCAmJiAhdGhpcy5fdXNlTmF0aXZlRHJpdmVyKSB7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlKHRoaXMuX3RvVmFsdWUpO1xuICAgICAgICB0aGlzLl9fZGVib3VuY2VkT25FbmQoe2ZpbmlzaGVkOiB0cnVlfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBpZiAodGhpcy5fdXNlTmF0aXZlRHJpdmVyKSB7XG4gICAgICAgICAgdGhpcy5fX3N0YXJ0TmF0aXZlQW5pbWF0aW9uKGFuaW1hdGVkVmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKFxuICAgICAgICAgICAgdGhpcy5vblVwZGF0ZS5iaW5kKHRoaXMpLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIGlmICh0aGlzLl9kZWxheSkge1xuICAgICAgdGhpcy5fdGltZW91dCA9IHNldFRpbWVvdXQoc3RhcnQsIHRoaXMuX2RlbGF5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhcnQoKTtcbiAgICB9XG4gIH1cblxuICBvblVwZGF0ZSgpOiB2b2lkIHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGlmIChub3cgPj0gdGhpcy5fc3RhcnRUaW1lICsgdGhpcy5fZHVyYXRpb24pIHtcbiAgICAgIGlmICh0aGlzLl9kdXJhdGlvbiA9PT0gMCkge1xuICAgICAgICB0aGlzLl9vblVwZGF0ZSh0aGlzLl90b1ZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX29uVXBkYXRlKFxuICAgICAgICAgIHRoaXMuX2Zyb21WYWx1ZSArIHRoaXMuX2Vhc2luZygxKSAqICh0aGlzLl90b1ZhbHVlIC0gdGhpcy5fZnJvbVZhbHVlKSxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7ZmluaXNoZWQ6IHRydWV9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9vblVwZGF0ZShcbiAgICAgIHRoaXMuX2Zyb21WYWx1ZSArXG4gICAgICAgIHRoaXMuX2Vhc2luZygobm93IC0gdGhpcy5fc3RhcnRUaW1lKSAvIHRoaXMuX2R1cmF0aW9uKSAqXG4gICAgICAgICAgKHRoaXMuX3RvVmFsdWUgLSB0aGlzLl9mcm9tVmFsdWUpLFxuICAgICk7XG4gICAgaWYgKHRoaXMuX19hY3RpdmUpIHtcbiAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMub25VcGRhdGUuYmluZCh0aGlzKSk7XG4gICAgfVxuICB9XG5cbiAgc3RvcCgpOiB2b2lkIHtcbiAgICBzdXBlci5zdG9wKCk7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTtcbiAgICBnbG9iYWwuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fYW5pbWF0aW9uRnJhbWUpO1xuICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7ZmluaXNoZWQ6IGZhbHNlfSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBUaW1pbmdBbmltYXRpb247XG4iXX0=