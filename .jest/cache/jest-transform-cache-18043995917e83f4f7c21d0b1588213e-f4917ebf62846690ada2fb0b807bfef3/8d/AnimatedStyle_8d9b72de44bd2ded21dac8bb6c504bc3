d2b60fddd72924f74c448e6ddf320de7
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var AnimatedNode = require('./AnimatedNode');

var AnimatedTransform = require('./AnimatedTransform');

var AnimatedWithChildren = require('./AnimatedWithChildren');

var NativeAnimatedHelper = require('../NativeAnimatedHelper');

var flattenStyle = require('flattenStyle');

var AnimatedStyle = function (_AnimatedWithChildren) {
  (0, _inherits2.default)(AnimatedStyle, _AnimatedWithChildren);

  function AnimatedStyle(style) {
    var _this;

    (0, _classCallCheck2.default)(this, AnimatedStyle);
    _this = (0, _possibleConstructorReturn2.default)(this, (0, _getPrototypeOf2.default)(AnimatedStyle).call(this));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_style", void 0);
    style = flattenStyle(style) || {};

    if (style.transform) {
      style = (0, _objectSpread2.default)({}, style, {
        transform: new AnimatedTransform(style.transform)
      });
    }

    _this._style = style;
    return _this;
  }

  (0, _createClass2.default)(AnimatedStyle, [{
    key: "_walkStyleAndGetValues",
    value: function _walkStyleAndGetValues(style) {
      var updatedStyle = {};

      for (var key in style) {
        var value = style[key];

        if (value instanceof AnimatedNode) {
          if (!value.__isNative) {
            updatedStyle[key] = value.__getValue();
          }
        } else if (value && !Array.isArray(value) && typeof value === 'object') {
          updatedStyle[key] = this._walkStyleAndGetValues(value);
        } else {
          updatedStyle[key] = value;
        }
      }

      return updatedStyle;
    }
  }, {
    key: "__getValue",
    value: function __getValue() {
      return this._walkStyleAndGetValues(this._style);
    }
  }, {
    key: "_walkStyleAndGetAnimatedValues",
    value: function _walkStyleAndGetAnimatedValues(style) {
      var updatedStyle = {};

      for (var key in style) {
        var value = style[key];

        if (value instanceof AnimatedNode) {
          updatedStyle[key] = value.__getAnimatedValue();
        } else if (value && !Array.isArray(value) && typeof value === 'object') {
          updatedStyle[key] = this._walkStyleAndGetAnimatedValues(value);
        }
      }

      return updatedStyle;
    }
  }, {
    key: "__getAnimatedValue",
    value: function __getAnimatedValue() {
      return this._walkStyleAndGetAnimatedValues(this._style);
    }
  }, {
    key: "__attach",
    value: function __attach() {
      for (var key in this._style) {
        var value = this._style[key];

        if (value instanceof AnimatedNode) {
          value.__addChild(this);
        }
      }
    }
  }, {
    key: "__detach",
    value: function __detach() {
      for (var key in this._style) {
        var value = this._style[key];

        if (value instanceof AnimatedNode) {
          value.__removeChild(this);
        }
      }

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedStyle.prototype), "__detach", this).call(this);
    }
  }, {
    key: "__makeNative",
    value: function __makeNative() {
      for (var key in this._style) {
        var value = this._style[key];

        if (value instanceof AnimatedNode) {
          value.__makeNative();
        }
      }

      (0, _get2.default)((0, _getPrototypeOf2.default)(AnimatedStyle.prototype), "__makeNative", this).call(this);
    }
  }, {
    key: "__getNativeConfig",
    value: function __getNativeConfig() {
      var styleConfig = {};

      for (var styleKey in this._style) {
        if (this._style[styleKey] instanceof AnimatedNode) {
          styleConfig[styleKey] = this._style[styleKey].__getNativeTag();
        }
      }

      NativeAnimatedHelper.validateStyles(styleConfig);
      return {
        type: 'style',
        style: styleConfig
      };
    }
  }]);
  return AnimatedStyle;
}(AnimatedWithChildren);

module.exports = AnimatedStyle;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFuaW1hdGVkU3R5bGUuanMiXSwibmFtZXMiOlsiQW5pbWF0ZWROb2RlIiwicmVxdWlyZSIsIkFuaW1hdGVkVHJhbnNmb3JtIiwiQW5pbWF0ZWRXaXRoQ2hpbGRyZW4iLCJOYXRpdmVBbmltYXRlZEhlbHBlciIsImZsYXR0ZW5TdHlsZSIsIkFuaW1hdGVkU3R5bGUiLCJzdHlsZSIsInRyYW5zZm9ybSIsIl9zdHlsZSIsInVwZGF0ZWRTdHlsZSIsImtleSIsInZhbHVlIiwiX19pc05hdGl2ZSIsIl9fZ2V0VmFsdWUiLCJBcnJheSIsImlzQXJyYXkiLCJfd2Fsa1N0eWxlQW5kR2V0VmFsdWVzIiwiX19nZXRBbmltYXRlZFZhbHVlIiwiX3dhbGtTdHlsZUFuZEdldEFuaW1hdGVkVmFsdWVzIiwiX19hZGRDaGlsZCIsIl9fcmVtb3ZlQ2hpbGQiLCJfX21ha2VOYXRpdmUiLCJzdHlsZUNvbmZpZyIsInN0eWxlS2V5IiwiX19nZXROYXRpdmVUYWciLCJ2YWxpZGF0ZVN0eWxlcyIsInR5cGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFTQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLFlBQVksR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTVCOztBQUNBLElBQU1DLGlCQUFpQixHQUFHRCxPQUFPLENBQUMscUJBQUQsQ0FBakM7O0FBQ0EsSUFBTUUsb0JBQW9CLEdBQUdGLE9BQU8sQ0FBQyx3QkFBRCxDQUFwQzs7QUFDQSxJQUFNRyxvQkFBb0IsR0FBR0gsT0FBTyxDQUFDLHlCQUFELENBQXBDOztBQUVBLElBQU1JLFlBQVksR0FBR0osT0FBTyxDQUFDLGNBQUQsQ0FBNUI7O0lBRU1LLGE7OztBQUdKLHlCQUFZQyxLQUFaLEVBQXdCO0FBQUE7O0FBQUE7QUFDdEI7QUFEc0I7QUFFdEJBLElBQUFBLEtBQUssR0FBR0YsWUFBWSxDQUFDRSxLQUFELENBQVosSUFBdUIsRUFBL0I7O0FBQ0EsUUFBSUEsS0FBSyxDQUFDQyxTQUFWLEVBQXFC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QU47QUFDRDtBQUNGOztBQUNEO0FBQ0Q7Ozt3Q0FFMkI7QUFDMUIsVUFBTUMsV0FBVyxHQUFHLEVBQXBCOztBQUNBLFdBQUssSUFBTUMsUUFBWCxJQUF1QixLQUFLZixNQUE1QixFQUFvQztBQUNsQyxZQUFJLEtBQUtBLE1BQUwsQ0FBWWUsUUFBWixhQUFpQ3hCLFlBQXJDLEVBQW1EO0FBQ2pEdUIsVUFBQUEsV0FBVyxDQUFDQyxRQUFELENBQVgsR0FBd0IsS0FBS2YsTUFBTCxDQUFZZSxRQUFaLEVBQXNCQyxjQUF0QixFQUF4QjtBQUNEO0FBR0Y7O0FBQ0RyQixNQUFBQSxvQkFBb0IsQ0FBQ3NCLGNBQXJCLENBQW9DSCxXQUFwQztBQUNBLGFBQU87QUFDTEksUUFBQUEsSUFBSSxFQUFFLE9BREQ7QUFFTHBCLFFBQUFBLEtBQUssRUFBRWdCO0FBRkYsT0FBUDtBQUlEOzs7RUF0R3lCcEIsb0I7O0FBeUc1QnlCLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnZCLGFBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkTm9kZSA9IHJlcXVpcmUoJy4vQW5pbWF0ZWROb2RlJyk7XG5jb25zdCBBbmltYXRlZFRyYW5zZm9ybSA9IHJlcXVpcmUoJy4vQW5pbWF0ZWRUcmFuc2Zvcm0nKTtcbmNvbnN0IEFuaW1hdGVkV2l0aENoaWxkcmVuID0gcmVxdWlyZSgnLi9BbmltYXRlZFdpdGhDaGlsZHJlbicpO1xuY29uc3QgTmF0aXZlQW5pbWF0ZWRIZWxwZXIgPSByZXF1aXJlKCcuLi9OYXRpdmVBbmltYXRlZEhlbHBlcicpO1xuXG5jb25zdCBmbGF0dGVuU3R5bGUgPSByZXF1aXJlKCdmbGF0dGVuU3R5bGUnKTtcblxuY2xhc3MgQW5pbWF0ZWRTdHlsZSBleHRlbmRzIEFuaW1hdGVkV2l0aENoaWxkcmVuIHtcbiAgX3N0eWxlOiBPYmplY3Q7XG5cbiAgY29uc3RydWN0b3Ioc3R5bGU6IGFueSkge1xuICAgIHN1cGVyKCk7XG4gICAgc3R5bGUgPSBmbGF0dGVuU3R5bGUoc3R5bGUpIHx8IHt9O1xuICAgIGlmIChzdHlsZS50cmFuc2Zvcm0pIHtcbiAgICAgIHN0eWxlID0ge1xuICAgICAgICAuLi5zdHlsZSxcbiAgICAgICAgdHJhbnNmb3JtOiBuZXcgQW5pbWF0ZWRUcmFuc2Zvcm0oc3R5bGUudHJhbnNmb3JtKSxcbiAgICAgIH07XG4gICAgfVxuICAgIHRoaXMuX3N0eWxlID0gc3R5bGU7XG4gIH1cblxuICAvLyBSZWN1cnNpdmVseSBnZXQgdmFsdWVzIGZvciBuZXN0ZWQgc3R5bGVzIChsaWtlIGlPUydzIHNoYWRvd09mZnNldClcbiAgX3dhbGtTdHlsZUFuZEdldFZhbHVlcyhzdHlsZSkge1xuICAgIGNvbnN0IHVwZGF0ZWRTdHlsZSA9IHt9O1xuICAgIGZvciAoY29uc3Qga2V5IGluIHN0eWxlKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHN0eWxlW2tleV07XG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBbmltYXRlZE5vZGUpIHtcbiAgICAgICAgaWYgKCF2YWx1ZS5fX2lzTmF0aXZlKSB7XG4gICAgICAgICAgLy8gV2UgY2Fubm90IHVzZSB2YWx1ZSBvZiBuYXRpdmVseSBkcml2ZW4gbm9kZXMgdGhpcyB3YXkgYXMgdGhlIHZhbHVlIHdlIGhhdmUgYWNjZXNzIGZyb21cbiAgICAgICAgICAvLyBKUyBtYXkgbm90IGJlIHVwIHRvIGRhdGUuXG4gICAgICAgICAgdXBkYXRlZFN0eWxlW2tleV0gPSB2YWx1ZS5fX2dldFZhbHVlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gU3VwcG9ydCBhbmltYXRpbmcgbmVzdGVkIHZhbHVlcyAoZm9yIGV4YW1wbGU6IHNoYWRvd09mZnNldC5oZWlnaHQpXG4gICAgICAgIHVwZGF0ZWRTdHlsZVtrZXldID0gdGhpcy5fd2Fsa1N0eWxlQW5kR2V0VmFsdWVzKHZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVwZGF0ZWRTdHlsZVtrZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1cGRhdGVkU3R5bGU7XG4gIH1cblxuICBfX2dldFZhbHVlKCk6IE9iamVjdCB7XG4gICAgcmV0dXJuIHRoaXMuX3dhbGtTdHlsZUFuZEdldFZhbHVlcyh0aGlzLl9zdHlsZSk7XG4gIH1cblxuICAvLyBSZWN1cnNpdmVseSBnZXQgYW5pbWF0ZWQgdmFsdWVzIGZvciBuZXN0ZWQgc3R5bGVzIChsaWtlIGlPUydzIHNoYWRvd09mZnNldClcbiAgX3dhbGtTdHlsZUFuZEdldEFuaW1hdGVkVmFsdWVzKHN0eWxlKSB7XG4gICAgY29uc3QgdXBkYXRlZFN0eWxlID0ge307XG4gICAgZm9yIChjb25zdCBrZXkgaW4gc3R5bGUpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gc3R5bGVba2V5XTtcbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFuaW1hdGVkTm9kZSkge1xuICAgICAgICB1cGRhdGVkU3R5bGVba2V5XSA9IHZhbHVlLl9fZ2V0QW5pbWF0ZWRWYWx1ZSgpO1xuICAgICAgfSBlbHNlIGlmICh2YWx1ZSAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBTdXBwb3J0IGFuaW1hdGluZyBuZXN0ZWQgdmFsdWVzIChmb3IgZXhhbXBsZTogc2hhZG93T2Zmc2V0LmhlaWdodClcbiAgICAgICAgdXBkYXRlZFN0eWxlW2tleV0gPSB0aGlzLl93YWxrU3R5bGVBbmRHZXRBbmltYXRlZFZhbHVlcyh2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB1cGRhdGVkU3R5bGU7XG4gIH1cblxuICBfX2dldEFuaW1hdGVkVmFsdWUoKTogT2JqZWN0IHtcbiAgICByZXR1cm4gdGhpcy5fd2Fsa1N0eWxlQW5kR2V0QW5pbWF0ZWRWYWx1ZXModGhpcy5fc3R5bGUpO1xuICB9XG5cbiAgX19hdHRhY2goKTogdm9pZCB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy5fc3R5bGUpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5fc3R5bGVba2V5XTtcbiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEFuaW1hdGVkTm9kZSkge1xuICAgICAgICB2YWx1ZS5fX2FkZENoaWxkKHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9fZGV0YWNoKCk6IHZvaWQge1xuICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuX3N0eWxlKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuX3N0eWxlW2tleV07XG4gICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBbmltYXRlZE5vZGUpIHtcbiAgICAgICAgdmFsdWUuX19yZW1vdmVDaGlsZCh0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3VwZXIuX19kZXRhY2goKTtcbiAgfVxuXG4gIF9fbWFrZU5hdGl2ZSgpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLl9zdHlsZSkge1xuICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLl9zdHlsZVtrZXldO1xuICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQW5pbWF0ZWROb2RlKSB7XG4gICAgICAgIHZhbHVlLl9fbWFrZU5hdGl2ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBzdXBlci5fX21ha2VOYXRpdmUoKTtcbiAgfVxuXG4gIF9fZ2V0TmF0aXZlQ29uZmlnKCk6IE9iamVjdCB7XG4gICAgY29uc3Qgc3R5bGVDb25maWcgPSB7fTtcbiAgICBmb3IgKGNvbnN0IHN0eWxlS2V5IGluIHRoaXMuX3N0eWxlKSB7XG4gICAgICBpZiAodGhpcy5fc3R5bGVbc3R5bGVLZXldIGluc3RhbmNlb2YgQW5pbWF0ZWROb2RlKSB7XG4gICAgICAgIHN0eWxlQ29uZmlnW3N0eWxlS2V5XSA9IHRoaXMuX3N0eWxlW3N0eWxlS2V5XS5fX2dldE5hdGl2ZVRhZygpO1xuICAgICAgfVxuICAgICAgLy8gTm9uLWFuaW1hdGVkIHN0eWxlcyBhcmUgc2V0IHVzaW5nIGBzZXROYXRpdmVQcm9wc2AsIG5vIG5lZWRcbiAgICAgIC8vIHRvIHBhc3MgdGhvc2UgYXMgYSBwYXJ0IG9mIHRoZSBub2RlIGNvbmZpZ1xuICAgIH1cbiAgICBOYXRpdmVBbmltYXRlZEhlbHBlci52YWxpZGF0ZVN0eWxlcyhzdHlsZUNvbmZpZyk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6ICdzdHlsZScsXG4gICAgICBzdHlsZTogc3R5bGVDb25maWcsXG4gICAgfTtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFuaW1hdGVkU3R5bGU7XG4iXX0=