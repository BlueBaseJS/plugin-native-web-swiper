349dedb7c54423582453dda51ee06085
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var ListView = require('ListView');

var React = require('React');

var RefreshControl = require('RefreshControl');

var ScrollView = require('ScrollView');

var invariant = require('fbjs/lib/invariant');

var MetroListView = function (_React$Component) {
  (0, _inherits2.default)(MetroListView, _React$Component);

  function MetroListView() {
    var _getPrototypeOf2,
        _this2 = this;

    var _this;

    (0, _classCallCheck2.default)(this, MetroListView);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(MetroListView)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "state", _this._computeState(_this.props, {
      ds: new ListView.DataSource({
        rowHasChanged: function rowHasChanged(itemA, itemB) {
          return true;
        },
        sectionHeaderHasChanged: function sectionHeaderHasChanged() {
          return true;
        },
        getSectionHeaderData: function getSectionHeaderData(dataBlob, sectionID) {
          return _this.state.sectionHeaderData[sectionID];
        }
      }),
      sectionHeaderData: {}
    }));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_listRef", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_captureRef", function (ref) {
      _this._listRef = ref;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_renderFooter", function () {
      return React.createElement(_this2.props.FooterComponent, {
        key: "$footer"
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_renderRow", function (item, sectionID, rowID, highlightRow) {
      return _this.props.renderItem({
        item: item,
        index: rowID
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_renderSectionHeader", function (section, sectionID) {
      var renderSectionHeader = _this.props.renderSectionHeader;
      invariant(renderSectionHeader, 'Must provide renderSectionHeader with sections prop');
      return renderSectionHeader({
        section: section
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_renderSeparator", function (sID, rID) {
      return React.createElement(_this2.props.SeparatorComponent, {
        key: sID + rID
      });
    });
    return _this;
  }

  (0, _createClass2.default)(MetroListView, [{
    key: "scrollToEnd",
    value: function scrollToEnd(params) {
      throw new Error('scrollToEnd not supported in legacy ListView.');
    }
  }, {
    key: "scrollToIndex",
    value: function scrollToIndex(params) {
      throw new Error('scrollToIndex not supported in legacy ListView.');
    }
  }, {
    key: "scrollToItem",
    value: function scrollToItem(params) {
      throw new Error('scrollToItem not supported in legacy ListView.');
    }
  }, {
    key: "scrollToLocation",
    value: function scrollToLocation(params) {
      throw new Error('scrollToLocation not supported in legacy ListView.');
    }
  }, {
    key: "scrollToOffset",
    value: function scrollToOffset(params) {
      var animated = params.animated,
          offset = params.offset;

      this._listRef.scrollTo(this.props.horizontal ? {
        x: offset,
        animated: animated
      } : {
        y: offset,
        animated: animated
      });
    }
  }, {
    key: "getListRef",
    value: function getListRef() {
      return this._listRef;
    }
  }, {
    key: "setNativeProps",
    value: function setNativeProps(props) {
      if (this._listRef) {
        this._listRef.setNativeProps(props);
      }
    }
  }, {
    key: "UNSAFE_componentWillReceiveProps",
    value: function UNSAFE_componentWillReceiveProps(newProps) {
      var _this3 = this;

      this.setState(function (state) {
        return _this3._computeState(newProps, state);
      });
    }
  }, {
    key: "render",
    value: function render() {
      return React.createElement(ListView, (0, _extends2.default)({}, this.props, {
        dataSource: this.state.ds,
        ref: this._captureRef,
        renderRow: this._renderRow,
        renderFooter: this.props.FooterComponent && this._renderFooter,
        renderSectionHeader: this.props.sections && this._renderSectionHeader,
        renderSeparator: this.props.SeparatorComponent && this._renderSeparator
      }));
    }
  }, {
    key: "_computeState",
    value: function _computeState(props, state) {
      var sectionHeaderData = {};

      if (props.sections) {
        invariant(!props.items, 'Cannot have both sections and items props.');
        var sections = {};
        props.sections.forEach(function (sectionIn, ii) {
          var sectionID = 's' + ii;
          sections[sectionID] = sectionIn.data;
          sectionHeaderData[sectionID] = sectionIn;
        });
        return {
          ds: state.ds.cloneWithRowsAndSections(sections),
          sectionHeaderData: sectionHeaderData
        };
      } else {
        invariant(!props.sections, 'Cannot have both sections and items props.');
        return {
          ds: state.ds.cloneWithRows(props.items),
          sectionHeaderData: sectionHeaderData
        };
      }
    }
  }]);
  return MetroListView;
}(React.Component);

(0, _defineProperty2.default)(MetroListView, "defaultProps", {
  keyExtractor: function keyExtractor(item, index) {
    return item.key || String(index);
  },
  renderScrollComponent: function renderScrollComponent(props) {
    if (props.onRefresh) {
      return React.createElement(ScrollView, (0, _extends2.default)({}, props, {
        refreshControl: React.createElement(RefreshControl, {
          refreshing: props.refreshing,
          onRefresh: props.onRefresh
        })
      }));
    } else {
      return React.createElement(ScrollView, props);
    }
  }
});
module.exports = MetroListView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1ldHJvTGlzdFZpZXcuanMiXSwibmFtZXMiOlsiTGlzdFZpZXciLCJyZXF1aXJlIiwiUmVhY3QiLCJSZWZyZXNoQ29udHJvbCIsIlNjcm9sbFZpZXciLCJpbnZhcmlhbnQiLCJNZXRyb0xpc3RWaWV3IiwiX2NvbXB1dGVTdGF0ZSIsInByb3BzIiwiZHMiLCJEYXRhU291cmNlIiwicm93SGFzQ2hhbmdlZCIsIml0ZW1BIiwiaXRlbUIiLCJzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCIsImdldFNlY3Rpb25IZWFkZXJEYXRhIiwiZGF0YUJsb2IiLCJzZWN0aW9uSUQiLCJzdGF0ZSIsInNlY3Rpb25IZWFkZXJEYXRhIiwicmVmIiwiX2xpc3RSZWYiLCJpdGVtIiwicm93SUQiLCJoaWdobGlnaHRSb3ciLCJyZW5kZXJJdGVtIiwiaW5kZXgiLCJzZWN0aW9uIiwicmVuZGVyU2VjdGlvbkhlYWRlciIsInNJRCIsInJJRCIsInBhcmFtcyIsIkVycm9yIiwiYW5pbWF0ZWQiLCJvZmZzZXQiLCJzY3JvbGxUbyIsImhvcml6b250YWwiLCJ4IiwieSIsInNldE5hdGl2ZVByb3BzIiwibmV3UHJvcHMiLCJzZXRTdGF0ZSIsIl9jYXB0dXJlUmVmIiwiX3JlbmRlclJvdyIsIkZvb3RlckNvbXBvbmVudCIsIl9yZW5kZXJGb290ZXIiLCJzZWN0aW9ucyIsIl9yZW5kZXJTZWN0aW9uSGVhZGVyIiwiU2VwYXJhdG9yQ29tcG9uZW50IiwiX3JlbmRlclNlcGFyYXRvciIsIml0ZW1zIiwiZm9yRWFjaCIsInNlY3Rpb25JbiIsImlpIiwiZGF0YSIsImNsb25lV2l0aFJvd3NBbmRTZWN0aW9ucyIsImNsb25lV2l0aFJvd3MiLCJDb21wb25lbnQiLCJrZXlFeHRyYWN0b3IiLCJrZXkiLCJTdHJpbmciLCJyZW5kZXJTY3JvbGxDb21wb25lbnQiLCJvblJlZnJlc2giLCJyZWZyZXNoaW5nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBU0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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TztBQUVMLGFBQU8sb0JBQUMsVUFBRCxFQUFnQnRELEtBQWhCLENBQVA7QUFDRDtBQUNGO0FBeEJpQyxDO0FBc0d0Q3dELE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjNELGFBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IExpc3RWaWV3ID0gcmVxdWlyZSgnTGlzdFZpZXcnKTtcbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgnUmVhY3QnKTtcbmNvbnN0IFJlZnJlc2hDb250cm9sID0gcmVxdWlyZSgnUmVmcmVzaENvbnRyb2wnKTtcbmNvbnN0IFNjcm9sbFZpZXcgPSByZXF1aXJlKCdTY3JvbGxWaWV3Jyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ZianMvbGliL2ludmFyaWFudCcpO1xuXG50eXBlIEl0ZW0gPSBhbnk7XG5cbnR5cGUgTm9ybWFsUHJvcHMgPSB7XG4gIEZvb3RlckNvbXBvbmVudD86IFJlYWN0LkNvbXBvbmVudFR5cGU8Kj4sXG4gIHJlbmRlckl0ZW06IChpbmZvOiBPYmplY3QpID0+ID9SZWFjdC5FbGVtZW50PGFueT4sXG4gIC8qICRGbG93Rml4TWUoPj0wLjUzLjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIscmVhY3RfbmF0aXZlX29zcykgVGhpcyBjb21tZW50XG4gICAqIHN1cHByZXNzZXMgYW4gZXJyb3Igd2hlbiB1cGdyYWRpbmcgRmxvdydzIHN1cHBvcnQgZm9yIFJlYWN0LiBUbyBzZWUgdGhlXG4gICAqIGVycm9yIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICByZW5kZXJTZWN0aW9uSGVhZGVyPzogKHtzZWN0aW9uOiBPYmplY3R9KSA9PiA/UmVhY3QuRWxlbWVudDxhbnk+LFxuICBTZXBhcmF0b3JDb21wb25lbnQ/OiA/UmVhY3QuQ29tcG9uZW50VHlwZTwqPiwgLy8gbm90IHN1cHBvcnRlZCB5ZXRcblxuICAvLyBQcm92aWRlIGVpdGhlciBgaXRlbXNgIG9yIGBzZWN0aW9uc2BcbiAgaXRlbXM/OiA/QXJyYXk8SXRlbT4sIC8vIEJ5IGRlZmF1bHQsIGFuIEl0ZW0gaXMgYXNzdW1lZCB0byBiZSB7a2V5OiBzdHJpbmd9XG4gIC8vICRGbG93Rml4TWUgLSBTb21ldGhpbmcgaXMgYSBsaXR0bGUgb2ZmIHdpdGggdGhlIHR5cGUgQXJyYXk8SXRlbT5cbiAgc2VjdGlvbnM/OiA/QXJyYXk8e2tleTogc3RyaW5nLCBkYXRhOiBBcnJheTxJdGVtPn0+LFxuXG4gIC8qKlxuICAgKiBJZiBwcm92aWRlZCwgYSBzdGFuZGFyZCBSZWZyZXNoQ29udHJvbCB3aWxsIGJlIGFkZGVkIGZvciBcIlB1bGwgdG8gUmVmcmVzaFwiIGZ1bmN0aW9uYWxpdHkuIE1ha2VcbiAgICogc3VyZSB0byBhbHNvIHNldCB0aGUgYHJlZnJlc2hpbmdgIHByb3AgY29ycmVjdGx5LlxuICAgKi9cbiAgb25SZWZyZXNoPzogP0Z1bmN0aW9uLFxuICAvKipcbiAgICogU2V0IHRoaXMgdHJ1ZSB3aGlsZSB3YWl0aW5nIGZvciBuZXcgZGF0YSBmcm9tIGEgcmVmcmVzaC5cbiAgICovXG4gIHJlZnJlc2hpbmc/OiBib29sZWFuLFxuICAvKipcbiAgICogSWYgdHJ1ZSwgcmVuZGVycyBpdGVtcyBuZXh0IHRvIGVhY2ggb3RoZXIgaG9yaXpvbnRhbGx5IGluc3RlYWQgb2Ygc3RhY2tlZCB2ZXJ0aWNhbGx5LlxuICAgKi9cbiAgaG9yaXpvbnRhbD86ID9ib29sZWFuLFxufTtcbnR5cGUgRGVmYXVsdFByb3BzID0ge1xuICBrZXlFeHRyYWN0b3I6IChpdGVtOiBJdGVtLCBpbmRleDogbnVtYmVyKSA9PiBzdHJpbmcsXG59O1xudHlwZSBQcm9wcyA9IE5vcm1hbFByb3BzICYgRGVmYXVsdFByb3BzO1xuXG4vKipcbiAqIFRoaXMgaXMganVzdCBhIHdyYXBwZXIgYXJvdW5kIHRoZSBsZWdhY3kgTGlzdFZpZXcgdGhhdCBtYXRjaGVzIHRoZSBuZXcgQVBJIG9mIEZsYXRMaXN0LCBidXQgd2l0aFxuICogc29tZSBzZWN0aW9uIHN1cHBvcnQgdGFja2VkIG9uLiBJdCBpcyByZWNvbW1lbmRlZCB0byBqdXN0IHVzZSBGbGF0TGlzdCBkaXJlY3RseSwgdGhpcyBjb21wb25lbnRcbiAqIGlzIG1vc3RseSBmb3IgZGVidWdnaW5nIGFuZCBwZXJmb3JtYW5jZSBjb21wYXJpc29uLlxuICovXG5jbGFzcyBNZXRyb0xpc3RWaWV3IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzLCAkRmxvd0ZpeE1lU3RhdGU+IHtcbiAgc2Nyb2xsVG9FbmQocGFyYW1zPzogP3thbmltYXRlZD86ID9ib29sZWFufSkge1xuICAgIHRocm93IG5ldyBFcnJvcignc2Nyb2xsVG9FbmQgbm90IHN1cHBvcnRlZCBpbiBsZWdhY3kgTGlzdFZpZXcuJyk7XG4gIH1cbiAgc2Nyb2xsVG9JbmRleChwYXJhbXM6IHtcbiAgICBhbmltYXRlZD86ID9ib29sZWFuLFxuICAgIGluZGV4OiBudW1iZXIsXG4gICAgdmlld1Bvc2l0aW9uPzogbnVtYmVyLFxuICB9KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzY3JvbGxUb0luZGV4IG5vdCBzdXBwb3J0ZWQgaW4gbGVnYWN5IExpc3RWaWV3LicpO1xuICB9XG4gIHNjcm9sbFRvSXRlbShwYXJhbXM6IHtcbiAgICBhbmltYXRlZD86ID9ib29sZWFuLFxuICAgIGl0ZW06IEl0ZW0sXG4gICAgdmlld1Bvc2l0aW9uPzogbnVtYmVyLFxuICB9KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzY3JvbGxUb0l0ZW0gbm90IHN1cHBvcnRlZCBpbiBsZWdhY3kgTGlzdFZpZXcuJyk7XG4gIH1cbiAgc2Nyb2xsVG9Mb2NhdGlvbihwYXJhbXM6IHtcbiAgICBhbmltYXRlZD86ID9ib29sZWFuLFxuICAgIGl0ZW1JbmRleDogbnVtYmVyLFxuICAgIHNlY3Rpb25JbmRleDogbnVtYmVyLFxuICAgIHZpZXdPZmZzZXQ/OiBudW1iZXIsXG4gICAgdmlld1Bvc2l0aW9uPzogbnVtYmVyLFxuICB9KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdzY3JvbGxUb0xvY2F0aW9uIG5vdCBzdXBwb3J0ZWQgaW4gbGVnYWN5IExpc3RWaWV3LicpO1xuICB9XG4gIHNjcm9sbFRvT2Zmc2V0KHBhcmFtczoge2FuaW1hdGVkPzogP2Jvb2xlYW4sIG9mZnNldDogbnVtYmVyfSkge1xuICAgIGNvbnN0IHthbmltYXRlZCwgb2Zmc2V0fSA9IHBhcmFtcztcbiAgICAvLyAkRmxvd0ZpeE1lIEludmFsaWQgcHJvcCB1c2FnZVxuICAgIHRoaXMuX2xpc3RSZWYuc2Nyb2xsVG8oXG4gICAgICB0aGlzLnByb3BzLmhvcml6b250YWwgPyB7eDogb2Zmc2V0LCBhbmltYXRlZH0gOiB7eTogb2Zmc2V0LCBhbmltYXRlZH0sXG4gICAgKTtcbiAgfVxuICBnZXRMaXN0UmVmKCkge1xuICAgIHJldHVybiB0aGlzLl9saXN0UmVmO1xuICB9XG4gIHNldE5hdGl2ZVByb3BzKHByb3BzOiBPYmplY3QpIHtcbiAgICBpZiAodGhpcy5fbGlzdFJlZikge1xuICAgICAgdGhpcy5fbGlzdFJlZi5zZXROYXRpdmVQcm9wcyhwcm9wcyk7XG4gICAgfVxuICB9XG4gIHN0YXRpYyBkZWZhdWx0UHJvcHM6IERlZmF1bHRQcm9wcyA9IHtcbiAgICBrZXlFeHRyYWN0b3I6IChpdGVtLCBpbmRleCkgPT4gaXRlbS5rZXkgfHwgU3RyaW5nKGluZGV4KSxcbiAgICByZW5kZXJTY3JvbGxDb21wb25lbnQ6IChwcm9wczogUHJvcHMpID0+IHtcbiAgICAgIGlmIChwcm9wcy5vblJlZnJlc2gpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvLyAkRmxvd0ZpeE1lIEludmFsaWQgcHJvcCB1c2FnZVxuICAgICAgICAgIDxTY3JvbGxWaWV3XG4gICAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgICByZWZyZXNoQ29udHJvbD17XG4gICAgICAgICAgICAgIC8qICRGbG93Rml4TWUoPj0wLjUzLjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIscmVhY3RfbmF0aXZlX29zcylcbiAgICAgICAgICAgICAgICogVGhpcyBjb21tZW50IHN1cHByZXNzZXMgYW4gZXJyb3Igd2hlbiB1cGdyYWRpbmcgRmxvdydzIHN1cHBvcnRcbiAgICAgICAgICAgICAgICogZm9yIFJlYWN0LiBUbyBzZWUgdGhlIGVycm9yIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LlxuICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgPFJlZnJlc2hDb250cm9sXG4gICAgICAgICAgICAgICAgcmVmcmVzaGluZz17cHJvcHMucmVmcmVzaGluZ31cbiAgICAgICAgICAgICAgICBvblJlZnJlc2g9e3Byb3BzLm9uUmVmcmVzaH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAvPlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gJEZsb3dGaXhNZSBJbnZhbGlkIHByb3AgdXNhZ2VcbiAgICAgICAgcmV0dXJuIDxTY3JvbGxWaWV3IHsuLi5wcm9wc30gLz47XG4gICAgICB9XG4gICAgfSxcbiAgfTtcbiAgc3RhdGUgPSB0aGlzLl9jb21wdXRlU3RhdGUodGhpcy5wcm9wcywge1xuICAgIGRzOiBuZXcgTGlzdFZpZXcuRGF0YVNvdXJjZSh7XG4gICAgICByb3dIYXNDaGFuZ2VkOiAoaXRlbUEsIGl0ZW1CKSA9PiB0cnVlLFxuICAgICAgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ6ICgpID0+IHRydWUsXG4gICAgICBnZXRTZWN0aW9uSGVhZGVyRGF0YTogKGRhdGFCbG9iLCBzZWN0aW9uSUQpID0+XG4gICAgICAgIHRoaXMuc3RhdGUuc2VjdGlvbkhlYWRlckRhdGFbc2VjdGlvbklEXSxcbiAgICB9KSxcbiAgICBzZWN0aW9uSGVhZGVyRGF0YToge30sXG4gIH0pO1xuICBVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXdQcm9wczogUHJvcHMpIHtcbiAgICB0aGlzLnNldFN0YXRlKHN0YXRlID0+IHRoaXMuX2NvbXB1dGVTdGF0ZShuZXdQcm9wcywgc3RhdGUpKTtcbiAgfVxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIC8vICRGbG93Rml4TWUgRm91bmQgd2hlbiB0eXBpbmcgTGlzdFZpZXdcbiAgICAgIDxMaXN0Vmlld1xuICAgICAgICB7Li4udGhpcy5wcm9wc31cbiAgICAgICAgZGF0YVNvdXJjZT17dGhpcy5zdGF0ZS5kc31cbiAgICAgICAgcmVmPXt0aGlzLl9jYXB0dXJlUmVmfVxuICAgICAgICByZW5kZXJSb3c9e3RoaXMuX3JlbmRlclJvd31cbiAgICAgICAgcmVuZGVyRm9vdGVyPXt0aGlzLnByb3BzLkZvb3RlckNvbXBvbmVudCAmJiB0aGlzLl9yZW5kZXJGb290ZXJ9XG4gICAgICAgIHJlbmRlclNlY3Rpb25IZWFkZXI9e3RoaXMucHJvcHMuc2VjdGlvbnMgJiYgdGhpcy5fcmVuZGVyU2VjdGlvbkhlYWRlcn1cbiAgICAgICAgcmVuZGVyU2VwYXJhdG9yPXt0aGlzLnByb3BzLlNlcGFyYXRvckNvbXBvbmVudCAmJiB0aGlzLl9yZW5kZXJTZXBhcmF0b3J9XG4gICAgICAvPlxuICAgICk7XG4gIH1cbiAgX2xpc3RSZWY6ID9MaXN0VmlldztcbiAgX2NhcHR1cmVSZWYgPSByZWYgPT4ge1xuICAgIHRoaXMuX2xpc3RSZWYgPSByZWY7XG4gIH07XG4gIF9jb21wdXRlU3RhdGUocHJvcHM6IFByb3BzLCBzdGF0ZSkge1xuICAgIGNvbnN0IHNlY3Rpb25IZWFkZXJEYXRhID0ge307XG4gICAgaWYgKHByb3BzLnNlY3Rpb25zKSB7XG4gICAgICBpbnZhcmlhbnQoIXByb3BzLml0ZW1zLCAnQ2Fubm90IGhhdmUgYm90aCBzZWN0aW9ucyBhbmQgaXRlbXMgcHJvcHMuJyk7XG4gICAgICBjb25zdCBzZWN0aW9ucyA9IHt9O1xuICAgICAgcHJvcHMuc2VjdGlvbnMuZm9yRWFjaCgoc2VjdGlvbkluLCBpaSkgPT4ge1xuICAgICAgICBjb25zdCBzZWN0aW9uSUQgPSAncycgKyBpaTtcbiAgICAgICAgc2VjdGlvbnNbc2VjdGlvbklEXSA9IHNlY3Rpb25Jbi5kYXRhO1xuICAgICAgICBzZWN0aW9uSGVhZGVyRGF0YVtzZWN0aW9uSURdID0gc2VjdGlvbkluO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkczogc3RhdGUuZHMuY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zKHNlY3Rpb25zKSxcbiAgICAgICAgc2VjdGlvbkhlYWRlckRhdGEsXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnZhcmlhbnQoIXByb3BzLnNlY3Rpb25zLCAnQ2Fubm90IGhhdmUgYm90aCBzZWN0aW9ucyBhbmQgaXRlbXMgcHJvcHMuJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAvLyAkRmxvd0ZpeE1lIEZvdW5kIHdoZW4gdHlwaW5nIExpc3RWaWV3XG4gICAgICAgIGRzOiBzdGF0ZS5kcy5jbG9uZVdpdGhSb3dzKHByb3BzLml0ZW1zKSxcbiAgICAgICAgc2VjdGlvbkhlYWRlckRhdGEsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKiAkRmxvd0ZpeE1lKD49MC41My4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiLHJlYWN0X25hdGl2ZV9vc3MpIFRoaXMgY29tbWVudFxuICAgKiBzdXBwcmVzc2VzIGFuIGVycm9yIHdoZW4gdXBncmFkaW5nIEZsb3cncyBzdXBwb3J0IGZvciBSZWFjdC4gVG8gc2VlIHRoZVxuICAgKiBlcnJvciBkZWxldGUgdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgX3JlbmRlckZvb3RlciA9ICgpID0+IDx0aGlzLnByb3BzLkZvb3RlckNvbXBvbmVudCBrZXk9XCIkZm9vdGVyXCIgLz47XG4gIF9yZW5kZXJSb3cgPSAoaXRlbSwgc2VjdGlvbklELCByb3dJRCwgaGlnaGxpZ2h0Um93KSA9PiB7XG4gICAgcmV0dXJuIHRoaXMucHJvcHMucmVuZGVySXRlbSh7aXRlbSwgaW5kZXg6IHJvd0lEfSk7XG4gIH07XG4gIF9yZW5kZXJTZWN0aW9uSGVhZGVyID0gKHNlY3Rpb24sIHNlY3Rpb25JRCkgPT4ge1xuICAgIGNvbnN0IHtyZW5kZXJTZWN0aW9uSGVhZGVyfSA9IHRoaXMucHJvcHM7XG4gICAgaW52YXJpYW50KFxuICAgICAgcmVuZGVyU2VjdGlvbkhlYWRlcixcbiAgICAgICdNdXN0IHByb3ZpZGUgcmVuZGVyU2VjdGlvbkhlYWRlciB3aXRoIHNlY3Rpb25zIHByb3AnLFxuICAgICk7XG4gICAgcmV0dXJuIHJlbmRlclNlY3Rpb25IZWFkZXIoe3NlY3Rpb259KTtcbiAgfTtcbiAgX3JlbmRlclNlcGFyYXRvciA9IChzSUQsIHJJRCkgPT4gKFxuICAgIC8qICRGbG93Rml4TWUoPj0wLjUzLjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIscmVhY3RfbmF0aXZlX29zcykgVGhpcyBjb21tZW50XG4gICAgICogc3VwcHJlc3NlcyBhbiBlcnJvciB3aGVuIHVwZ3JhZGluZyBGbG93J3Mgc3VwcG9ydCBmb3IgUmVhY3QuIFRvIHNlZSB0aGVcbiAgICAgKiBlcnJvciBkZWxldGUgdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICA8dGhpcy5wcm9wcy5TZXBhcmF0b3JDb21wb25lbnQga2V5PXtzSUQgKyBySUR9IC8+XG4gICk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTWV0cm9MaXN0VmlldztcbiJdfQ==